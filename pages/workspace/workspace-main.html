<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì›Œí¬ìŠ¤í˜ì´ìŠ¤ - WorkSpace</title>
    
    <!-- CSS íŒŒì¼ë“¤ ì„í¬íŠ¸ -->
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/workspace-main.css">
    
    
</head>
<body>
    <!-- íŒŒì¼ ì…ë ¥ (ìˆ¨ê¹€) -->
    <input type="file" id="file-input" multiple style="display: none;" accept="*/*">

    <div class="sidebar">
        <div class="workspace-header">
            <div class="workspace-name">ğŸŒŠ ì›Œí¬ìŠ¤í˜ì´ìŠ¤</div>
            <div class="workspace-info">íŒ€ í˜‘ì—… ê³µê°„</div>
        </div>
        
        <div class="channels-section">
            <div class="section-title">ì±„ë„</div>
            <div class="add-channel-button">
                <button onclick="location.href='channel-add.html'" title="ì±„ë„ ì¶”ê°€">â• ì±„ë„ ì¶”ê°€</button>
            </div>

        </div>

        <div class="user-section">
            <div class="section-title">íŒ€ì›</div>
            <div class="user-item">
                <div class="user-avatar">ê¹€</div>
                <span>ê¹€ê°œë°œ</span>
            </div>
            <div class="user-item">
                <div class="user-avatar">ì´</div>
                <span>ì´ë””ìì¸</span>
            </div>
            <div class="user-item">
                <div class="user-avatar">ë°•</div>
                <span>ë°•ë§ˆì¼€íŒ…</span>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="chat-header">
            <div class="header-left">
                <div class="channel-title"># ì „ì²´</div>
                <div class="channel-description">ì „ì²´ íŒ€ì›ì´ ì°¸ì—¬í•˜ëŠ” ì±„ë„ì…ë‹ˆë‹¤</div>
            </div>
        </div>

        <!-- íƒ­ ë²„íŠ¼ -->
        <div class="content-tabs">
            <button class="tab-button active" data-tab="chat" onclick="switchTab('chat')">
                ğŸ’¬ ëŒ€í™”
            </button>
            <button class="tab-button" data-tab="files" onclick="switchTab('files')">
                ğŸ“ íŒŒì¼
            </button>
        </div>

        <!-- ì±„íŒ… íƒ­ -->
        <div class="tab-content active" id="chat-content">
            <div class="chat-content">
                <div class="welcome-message" id="welcome-message">
                    <div class="welcome-icon">ğŸ </div>
                    <div class="welcome-title"># ì „ì²´ ì±„ë„ì— ëª¨ë‘ê°€ ìˆìŠµë‹ˆë‹¤</div>
                    <div class="welcome-description">
                        ê³µì§€ì™€ íšŒì‚¬ ë‰´ìŠ¤, íœ´ì¼ ì´ë²¤íŠ¸ ë˜ëŠ” ì²œì²œí•œ ì•„ì´ë””ì–´ë¥¼ ê³µìœ í•˜ì„¸ìš”. â­
                    </div>
                </div>

                <div class="chat-messages" id="chat-messages">
                    <div class="message">
                        <div class="message-avatar">ì •</div>
                        <div class="message-content">
                            <div class="message-header">
                                <span class="message-author">ì •ì§„ì„­</span>
                                <span class="message-time">ì˜¤ì „ 9:14</span>
                            </div>
                            <div class="message-text">
                                ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ ì‹œì‘í•©ë‹ˆë‹¤!<br>
                                ëª¨ë“  íŒ€ì›ë¶„ë“¤ì˜ ì ê·¹ì ì¸ ì°¸ì—¬ ë¶€íƒë“œë ¤ìš” ğŸš€
                            </div>
                        </div>
                    </div>
                </div>

                <div class="message-input-container">
                    <textarea class="message-input" id="message-input" placeholder="# ì „ì²´ ì±„ë„ì— ë©”ì‹œì§€ ë³´ë‚´ê¸°" rows="1"></textarea>
                    <div class="input-toolbar">
                        <div class="input-actions">
                            <button class="input-btn" onclick="attachFile()" title="íŒŒì¼ ì²¨ë¶€">ğŸ“</button>
                            <button class="input-btn" onclick="addEmoji()" title="ì´ëª¨ì§€">ğŸ˜Š</button>
                            <button class="input-btn" onclick="mentionUser()" title="ë©˜ì…˜">@</button>
                            <button class="input-btn" onclick="voiceMessage()" title="ìŒì„± ë©”ì‹œì§€">ğŸ¤</button>
                        </div>
                        <button class="send-btn" id="send-btn" onclick="sendMessage()">ì „ì†¡</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- íŒŒì¼ íƒ­ -->
        <div class="tab-content" id="files-content">
            <div class="files-content">
                <div class="upload-area" id="upload-area" onclick="triggerFileUpload()">
                    <div class="upload-icon">ğŸ“</div>
                    <div class="upload-title">íŒŒì¼ ì—…ë¡œë“œ</div>
                    <div class="upload-description">
                        íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì—¬ ë†“ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”
                    </div>
                    <button class="upload-button">
                        ğŸ“¤ íŒŒì¼ ì„ íƒ
                    </button>
                </div>

                <div class="upload-progress" id="upload-progress" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <div class="progress-text" id="progress-text">ì—…ë¡œë“œ ì¤‘...</div>
                </div>

                <div class="files-list">
                    <div class="files-header">
                        <div class="files-title">ì±„ë„ íŒŒì¼</div>
                    </div>
                    <div id="files-list-container">
                        <!-- íŒŒì¼ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================
        // ì „ì—­ ë³€ìˆ˜
        // ============================
        let currentChannel = 'general';
        let currentTab = 'chat';
        let channelData = {
            general: {
                name: 'ì „ì²´',
                description: 'ì „ì²´ íŒ€ì›ì´ ì°¸ì—¬í•˜ëŠ” ì±„ë„ì…ë‹ˆë‹¤',
                messages: [
                    {
                        author: 'ì •ì§„ì„­',
                        avatar: 'ì •',
                        time: 'ì˜¤ì „ 9:14',
                        text: 'ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ ì‹œì‘í•©ë‹ˆë‹¤!<br>ëª¨ë“  íŒ€ì›ë¶„ë“¤ì˜ ì ê·¹ì ì¸ ì°¸ì—¬ ë¶€íƒë“œë ¤ìš” ğŸš€'
                    }
                ],
                files: []
            },
            dev: {
                name: 'ê°œë°œíŒ€',
                description: 'ê°œë°œíŒ€ ì „ìš© ì±„ë„ì…ë‹ˆë‹¤',
                messages: [
                    {
                        author: 'ê¹€ê°œë°œ',
                        avatar: 'ê¹€',
                        time: 'ì˜¤ì „ 10:30',
                        text: 'API ë¬¸ì„œ ì—…ë°ì´íŠ¸ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤! ğŸ‘¨â€ğŸ’»'
                    }
                ],
                files: [
                    {
                        name: 'API_Documentation.pdf',
                        icon: 'ğŸ“„',
                        size: '2.5 MB',
                        author: 'ê¹€ê°œë°œ',
                        time: 'ì˜¤ì „ 10:25'
                    }
                ]
            },
            design: {
                name: 'ë””ìì¸',
                description: 'ë””ìì¸íŒ€ ì „ìš© ì±„ë„ì…ë‹ˆë‹¤',
                messages: [
                    {
                        author: 'ì´ë””ìì¸',
                        avatar: 'ì´',
                        time: 'ì˜¤í›„ 2:15',
                        text: 'ìƒˆë¡œìš´ UI ì»´í¬ë„ŒíŠ¸ ë””ìì¸ ê³µìœ ë“œë¦½ë‹ˆë‹¤ ğŸ¨'
                    }
                ],
                files: [
                    {
                        name: 'UI_Components.fig',
                        icon: 'ğŸ¨',
                        size: '15.2 MB',
                        author: 'ì´ë””ìì¸',
                        time: 'ì˜¤í›„ 2:10'
                    }
                ]
            },
            marketing: {
                name: 'ë§ˆì¼€íŒ…',
                description: 'ë§ˆì¼€íŒ…íŒ€ ì „ìš© ì±„ë„ì…ë‹ˆë‹¤',
                messages: [
                    {
                        author: 'ë°•ë§ˆì¼€íŒ…',
                        avatar: 'ë°•',
                        time: 'ì˜¤í›„ 3:45',
                        text: 'ì´ë²ˆ ë‹¬ ë§ˆì¼€íŒ… ì„±ê³¼ ë³´ê³ ì„œ ê³µìœ í•©ë‹ˆë‹¤ ğŸ“Š'
                    }
                ],
                files: [
                    {
                        name: 'Marketing_Report_Q1.xlsx',
                        icon: 'ğŸ“Š',
                        size: '890 KB',
                        author: 'ë°•ë§ˆì¼€íŒ…',
                        time: 'ì˜¤í›„ 3:40'
                    }
                ]
            },
            notice: {
                name: 'ê³µì§€ì‚¬í•­',
                description: 'ì¤‘ìš”í•œ ê³µì§€ì‚¬í•­ì„ í™•ì¸í•˜ì„¸ìš”',
                messages: [
                    {
                        author: 'ê´€ë¦¬ì',
                        avatar: 'ê´€',
                        time: 'ì–´ì œ',
                        text: 'ğŸ’¡ ìƒˆë¡œìš´ ì—…ë¬´ í”„ë¡œì„¸ìŠ¤ê°€ ë„ì…ë©ë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ ì²¨ë¶€ëœ ë¬¸ì„œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.'
                    }
                ],
                files: [
                    {
                        name: 'New_Process_Guide.pdf',
                        icon: 'ğŸ“‹',
                        size: '1.2 MB',
                        author: 'ê´€ë¦¬ì',
                        time: 'ì–´ì œ'
                    }
                ]
            }
        };

        // ============================
        // ì±„ë„ ì „í™˜
        // ============================
        document.querySelectorAll('.channel-item').forEach(item => {
            item.addEventListener('click', function() {
                const channelId = this.dataset.channelId;
                switchChannel(channelId);
            });
        });

        function switchChannel(channelId) {
            currentChannel = channelId;
            
            // ì‚¬ì´ë“œë°” í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.channel-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-channel-id="${channelId}"]`).classList.add('active');

            // í—¤ë” ì—…ë°ì´íŠ¸
            const channel = channelData[channelId];
            document.querySelector('.channel-title').textContent = `# ${channel.name}`;
            document.querySelector('.channel-description').textContent = channel.description;
            
            // ë©”ì‹œì§€ ì…ë ¥ placeholder ì—…ë°ì´íŠ¸
            document.getElementById('message-input').placeholder = `# ${channel.name} ì±„ë„ì— ë©”ì‹œì§€ ë³´ë‚´ê¸°`;

            // ì½˜í…ì¸  ì—…ë°ì´íŠ¸
            updateChannelContent();
        }

        function updateChannelContent() {
            const channel = channelData[currentChannel];
            
            // í™˜ì˜ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
            const welcomeMessage = document.getElementById('welcome-message');
            welcomeMessage.innerHTML = `
                <div class="welcome-icon">ğŸ </div>
                <div class="welcome-title"># ${channel.name} ì±„ë„ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤</div>
                <div class="welcome-description">
                    ${channel.description} ììœ ë¡­ê²Œ ì†Œí†µí•˜ê³  íŒŒì¼ì„ ê³µìœ í•˜ì„¸ìš”. â­
                </div>
            `;

            // ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
            renderMessages();
            
            // íŒŒì¼ ëª©ë¡ ì—…ë°ì´íŠ¸
            renderFiles();
        }

        // ============================
        // íƒ­ ì „í™˜
        // ============================
        function switchTab(tabName) {
            currentTab = tabName;
            
            // íƒ­ ë²„íŠ¼ í™œì„±í™”
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            // íƒ­ ì½˜í…ì¸  ì „í™˜
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`${tabName}-content`).classList.add('active');
        }

        // ============================
        // ë©”ì‹œì§€ ê´€ë ¨ ê¸°ëŠ¥
        // ============================
        function renderMessages() {
            const messagesContainer = document.getElementById('chat-messages');
            const channel = channelData[currentChannel];
            
            messagesContainer.innerHTML = channel.messages.map(message => `
                <div class="message">
                    <div class="message-avatar">${message.avatar}</div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-author">${message.author}</span>
                            <span class="message-time">${message.time}</span>
                        </div>
                        <div class="message-text">${message.text}</div>
                    </div>
                </div>
            `).join('');
            
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function sendMessage() {
            const input = document.getElementById('message-input');
            const text = input.value.trim();
            
            if (!text) return;

            const channel = channelData[currentChannel];
            const newMessage = {
                author: 'ë‚˜',
                avatar: 'ë‚˜',
                time: 'ë°©ê¸ˆ ì „',
                text: text.replace(/\n/g, '<br>')
            };

            channel.messages.push(newMessage);
            renderMessages();

            input.value = '';
            input.style.height = 'auto';
            
            // ì „ì†¡ ë²„íŠ¼ ë¹„í™œì„±í™”
            updateSendButton();
        }

        // ë©”ì‹œì§€ ì…ë ¥ ìë™ í¬ê¸° ì¡°ì ˆ
        const messageInput = document.getElementById('message-input');
        messageInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            updateSendButton();
        });

        function updateSendButton() {
            const sendBtn = document.getElementById('send-btn');
            const hasText = messageInput.value.trim().length > 0;
            sendBtn.disabled = !hasText;
        }

        // ì—”í„°í‚¤ë¡œ ì „ì†¡
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // ============================
        // íŒŒì¼ ì—…ë¡œë“œ ê´€ë ¨ ê¸°ëŠ¥
        // ============================
        const fileInput = document.getElementById('file-input');
        const uploadArea = document.getElementById('upload-area');

        function triggerFileUpload() {
            fileInput.click();
        }

        // íŒŒì¼ ì„ íƒ ì´ë²¤íŠ¸
        fileInput.addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            if (files.length > 0) {
                handleFileUpload(files);
            }
        });

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸
        let dragCounter = 0;

        document.addEventListener('dragenter', function(e) {
            e.preventDefault();
            dragCounter++;
            if (currentTab === 'files') {
                uploadArea.classList.add('dragover');
            }
        });

        document.addEventListener('dragleave', function(e) {
            e.preventDefault();
            dragCounter--;
            if (dragCounter === 0 && currentTab === 'files') {
                uploadArea.classList.remove('dragover');
            }
        });

        document.addEventListener('dragover', function(e) {
            e.preventDefault();
        });

        document.addEventListener('drop', function(e) {
            e.preventDefault();
            dragCounter = 0;
            
            if (currentTab === 'files') {
                uploadArea.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files);
                if (files.length > 0) {
                    handleFileUpload(files);
                }
            }
        });

        // íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
        function handleFileUpload(files) {
            const progressContainer = document.getElementById('upload-progress');
            const progressFill = document.getElementById('progress-fill');
            const progressText = document.getElementById('progress-text');

            // ì—…ë¡œë“œ ì‹œì‘
            progressContainer.style.display = 'block';
            progressFill.style.width = '0%';
            progressText.textContent = `${files.length}ê°œ íŒŒì¼ ì—…ë¡œë“œ ì¤‘...`;

            // ê°€ì§œ ì—…ë¡œë“œ ì§„í–‰ë¥ 
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 100) progress = 100;
                
                progressFill.style.width = progress + '%';
                
                if (progress >= 100) {
                    clearInterval(progressInterval);
                    completeFileUpload(files);
                }
            }, 150);
        }

        function completeFileUpload(files) {
            const channel = channelData[currentChannel];
            const progressContainer = document.getElementById('upload-progress');
            const progressText = document.getElementById('progress-text');

            // íŒŒì¼ì„ ì±„ë„ì— ì¶”ê°€
            files.forEach(file => {
                const newFile = {
                    name: file.name,
                    icon: getFileIcon(file.name),
                    size: formatFileSize(file.size),
                    author: 'ë‚˜',
                    time: 'ë°©ê¸ˆ ì „'
                };
                channel.files.push(newFile);
            });

            // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
            progressText.textContent = `âœ… ${files.length}ê°œ íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!`;
            
            setTimeout(() => {
                progressContainer.style.display = 'none';
                renderFiles();
            }, 2000);

            // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
            fileInput.value = '';
        }

        // íŒŒì¼ ì•„ì´ì½˜ ë°˜í™˜
        function getFileIcon(fileName) {
            const extension = fileName.split('.').pop().toLowerCase();
            const iconMap = {
                'pdf': 'ğŸ“„', 'doc': 'ğŸ“„', 'docx': 'ğŸ“„', 'txt': 'ğŸ“„',
                'xls': 'ğŸ“Š', 'xlsx': 'ğŸ“Š', 'csv': 'ğŸ“Š',
                'ppt': 'ğŸ“Š', 'pptx': 'ğŸ“Š',
                'jpg': 'ğŸ–¼ï¸', 'jpeg': 'ğŸ–¼ï¸', 'png': 'ğŸ–¼ï¸', 'gif': 'ğŸ–¼ï¸', 'svg': 'ğŸ–¼ï¸',
                'fig': 'ğŸ¨', 'sketch': 'ğŸ¨', 'ai': 'ğŸ¨', 'psd': 'ğŸ¨',
                'js': 'ğŸ’»', 'html': 'ğŸ’»', 'css': 'ğŸ’»', 'py': 'ğŸ’»', 'java': 'ğŸ’»',
                'zip': 'ğŸ“¦', 'rar': 'ğŸ“¦', '7z': 'ğŸ“¦',
                'mp4': 'ğŸ¥', 'avi': 'ğŸ¥', 'mov': 'ğŸ¥',
                'mp3': 'ğŸµ', 'wav': 'ğŸµ', 'flac': 'ğŸµ'
            };
            return iconMap[extension] || 'ğŸ“„';
        }

        // íŒŒì¼ í¬ê¸° í¬ë§·íŒ…
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // íŒŒì¼ ëª©ë¡ ë Œë”ë§
        function renderFiles() {
            const filesContainer = document.getElementById('files-list-container');
            const channel = channelData[currentChannel];
            
            if (channel.files.length === 0) {
                filesContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #64748b;">
                        <div style="font-size: 48px; margin-bottom: 16px;">ğŸ“</div>
                        <div style="font-size: 16px; font-weight: 500; margin-bottom: 8px;">ì•„ì§ ì—…ë¡œë“œëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤</div>
                        <div style="font-size: 14px;">íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ íŒ€ì›ë“¤ê³¼ ê³µìœ í•´ë³´ì„¸ìš”!</div>
                    </div>
                `;
                return;
            }

        // âœ… ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì±„ë„ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜ ì •ì˜
        async function loadWorkspaceChannels(workspaceId) {
        Â  const token = localStorage.getItem("access_token");
        Â  const res = await fetch(`https://your-api.com/workspaces/${workspaceId}/channels`, {
        Â  Â  headers: {
        Â  Â  Â  "Authorization": `Bearer ${token}`
        Â  Â  }
        Â  });

        Â  if (!res.ok) {
        Â  Â  alert("ğŸš« ì±„ë„ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
        Â  Â  return;
        Â  }

        Â  const channels = await res.json();
        Â  const channelList = document.querySelector('.channel-list');

        Â  channels.forEach(channel => {
        Â  Â  // channelDataì— ì¶”ê°€
        Â  Â  channelData[channel.id] = {
        Â  Â  Â  name: channel.name,
        Â  Â  Â  description: channel.is_public ? "ê³µê°œ ì±„ë„ì…ë‹ˆë‹¤" : "ğŸ”’ ë¹„ê³µê°œ ì±„ë„ì…ë‹ˆë‹¤",
        Â  Â  Â  messages: [],
        Â  Â  Â  files: []
        Â  Â  };

        Â  Â  const li = document.createElement('li');
        Â  Â  li.classList.add('channel-item');
        Â  Â  li.dataset.channelId = channel.id;
        Â  Â  li.innerHTML = `<span class="channel-icon">#</span> ${channel.name}${!channel.is_public ? ' ğŸ”’' : ''}`;
        Â  Â  li.addEventListener('click', () => {
        Â  Â  Â  if (channel.is_public) {
        Â  Â  Â  Â  switchChannel(channel.id);
        Â  Â  Â  } else {
        Â  Â  Â  Â  requestJoinPrivateChannel(channel.id, channel.workspace_id);
        Â  Â  Â  }
        Â  Â  });

        Â  Â  channelList.appendChild(li);
        Â  });
        }


            filesContainer.innerHTML = channel.files.map((file, index) => `
                <div class="file-item">
                    <div class="file-icon">${file.icon}</div>
                    <div class="file-info">
                        <div class="file-name">${file.name}</div>
                        <div class="file-meta">${file.size} â€¢ ${file.author} â€¢ ${file.time}</div>
                    </div>
                    <div class="file-actions">
                        <button class="file-action-btn" onclick="downloadFile(${index})" title="ë‹¤ìš´ë¡œë“œ">
                            ğŸ“¥
                        </button>
                        <button class="file-action-btn" onclick="shareFile(${index})" title="ê³µìœ ">
                            ğŸ”—
                        </button>
                        <button class="file-action-btn" onclick="deleteFile(${index})" title="ì‚­ì œ">
                            ğŸ—‘ï¸
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ============================
        // íŒŒì¼ ì•¡ì…˜ í•¨ìˆ˜ë“¤
        // ============================
        function downloadFile(index) {
            const channel = channelData[currentChannel];
            const file = channel.files[index];
            alert(`ğŸ“¥ "${file.name}" íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•©ë‹ˆë‹¤.`);
        }

        function shareFile(index) {
            const channel = channelData[currentChannel];
            const file = channel.files[index];
            
            if (navigator.clipboard) {
                const shareLink = `https://workspace.com/files/${currentChannel}/${file.name}`;
                navigator.clipboard.writeText(shareLink).then(() => {
                    alert(`ğŸ”— "${file.name}" ê³µìœ  ë§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!`);
                });
            } else {
                alert(`ğŸ”— "${file.name}" ê³µìœ  ë§í¬: https://workspace.com/files/${currentChannel}/${file.name}`);
            }
        }

        function deleteFile(index) {
            const channel = channelData[currentChannel];
            const file = channel.files[index];
            
            if (confirm(`"${file.name}" íŒŒì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                channel.files.splice(index, 1);
                renderFiles();
                alert(`ğŸ—‘ï¸ "${file.name}" íŒŒì¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
            }
        }

        // ============================
        // ì…ë ¥ ë„êµ¬ í•¨ìˆ˜ë“¤
        // ============================
        function attachFile() {
            triggerFileUpload();
        }

        function addEmoji() {
            const input = document.getElementById('message-input');
            const emojis = ['ğŸ˜Š', 'ğŸ‘', 'â¤ï¸', 'ğŸ‰', 'ğŸ’¯', 'ğŸ”¥', 'âœ¨', 'ğŸš€'];
            const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
            
            const cursorPos = input.selectionStart;
            const textBefore = input.value.substring(0, cursorPos);
            const textAfter = input.value.substring(cursorPos);
            
            input.value = textBefore + randomEmoji + textAfter;
            input.focus();
            input.setSelectionRange(cursorPos + 2, cursorPos + 2);
            
            updateSendButton();
        }

        function mentionUser() {
            const input = document.getElementById('message-input');
            const users = ['@ê¹€ê°œë°œ', '@ì´ë””ìì¸', '@ë°•ë§ˆì¼€íŒ…', '@ì •ì§„ì„­'];
            
            // ê°„ë‹¨í•œ ë©˜ì…˜ ë©”ë‰´ ì‹œë®¬ë ˆì´ì…˜
            const mention = prompt('ë©˜ì…˜í•  ì‚¬ìš©ìë¥¼ ì„ íƒí•˜ì„¸ìš”:\n' + users.join('\n'));
            if (mention && users.includes(mention)) {
                const cursorPos = input.selectionStart;
                const textBefore = input.value.substring(0, cursorPos);
                const textAfter = input.value.substring(cursorPos);
                
                input.value = textBefore + mention + ' ' + textAfter;
                input.focus();
                input.setSelectionRange(cursorPos + mention.length + 1, cursorPos + mention.length + 1);
                
                updateSendButton();
            }
        }

        function voiceMessage() {
            alert('ğŸ¤ ìŒì„± ë©”ì‹œì§€ ê¸°ëŠ¥ì€ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.');
        }

        // ============================
        // ì´ˆê¸°í™”
        // ============================
        document.addEventListener('DOMContentLoaded', function() {
            // ì´ˆê¸° ìƒíƒœ ì„¤ì •
            updateChannelContent();
            updateSendButton();
            
            // ê°œë°œì ë„êµ¬ìš© ë””ë²„ê¹…
            window.debugWorkspace = {
                switchChannel: (channelId) => switchChannel(channelId),
                addTestMessage: (channelId, message) => {
                    if (channelData[channelId]) {
                        channelData[channelId].messages.push({
                            author: 'í…ŒìŠ¤íŠ¸',
                            avatar: 'í…Œ',
                            time: 'ë°©ê¸ˆ ì „',
                            text: message || 'í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ì…ë‹ˆë‹¤'
                        });
                        if (currentChannel === channelId) {
                            renderMessages();
                        }
                    }
                },
                addTestFile: (channelId, fileName) => {
                    if (channelData[channelId]) {
                        channelData[channelId].files.push({
                            name: fileName || 'test_file.pdf',
                            icon: 'ğŸ“„',
                            size: '1.2 MB',
                            author: 'í…ŒìŠ¤íŠ¸',
                            time: 'ë°©ê¸ˆ ì „'
                        });
                        if (currentChannel === channelId) {
                            renderFiles();
                        }
                    }
                },
                getCurrentChannel: () => currentChannel,
                getChannelData: () => channelData
            };
            
            console.log('ğŸ”§ ê°œë°œì ë„êµ¬ì—ì„œ debugWorkspace ê°ì²´ë¥¼ ì‚¬ìš©í•˜ì—¬ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            console.log('ì˜ˆ: debugWorkspace.addTestMessage("dev", "í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€")');
        });

        // ============================
        // API ì—°ë™ ì¤€ë¹„ (ì£¼ì„ì²˜ë¦¬ - ë‚˜ì¤‘ì— ì‚¬ìš©)
        // ============================
        /*
        const API_BASE_URL = 'http://localhost:8000';

        async function sendMessageAPI(channelId, content) {
            try {
                const token = localStorage.getItem('access_token');
                const response = await fetch(`${API_BASE_URL}/channels/${channelId}/messages`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ content })
                });
                return response.ok;
            } catch (error) {
                console.error('ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨:', error);
                return false;
            }
        }

        async function uploadFileAPI(channelId, formData) {
            try {
                const token = localStorage.getItem('access_token');
                const response = await fetch(`${API_BASE_URL}/channels/${channelId}/files`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                });
                return response.ok;
            } catch (error) {
                console.error('íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨:', error);
                return false;
            }
        }

        async function loadChannelMessages(channelId) {
            try {
                const token = localStorage.getItem('access_token');
                const response = await fetch(`${API_BASE_URL}/channels/${channelId}/messages`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                if (response.ok) {
                    return await response.json();
                }
            } catch (error) {
                console.error('ë©”ì‹œì§€ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
            return [];
        }

        async function loadChannelFiles(channelId) {
            try {
                const token = localStorage.getItem('access_token');
                const response = await fetch(`${API_BASE_URL}/channels/${channelId}/files`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                if (response.ok) {
                    return await response.json();
                }
            } catch (error) {
                console.error('íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
            return [];
        }
        */
    </script>
</body>
</html>