<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ - WorkSpace</title>
    
    <!-- CSS íŒŒì¼ë“¤ ì„í¬íŠ¸ -->
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/admin-main.css">
    
</head>
<body>
    <!-- ë°°ê²½ ì¥ì‹ -->
    <div class="bg-decoration"></div>
    <div class="bg-decoration"></div>
    <div class="bg-decoration"></div>

    <div class="dashboard-container">
        <!-- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
        <button class="back-button" onclick="goBackToWorkspace()" title="ì›Œí¬ìŠ¤í˜ì´ìŠ¤ë¡œ ëŒì•„ê°€ê¸°">â†</button>

        <!-- í—¤ë” -->
        <div class="dashboard-header">
            <div class="admin-badge">ğŸ‘‘ ê´€ë¦¬ì</div>
            <div class="logo">ğŸŒŠ</div>
            <h1 class="dashboard-title">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
            <p class="dashboard-subtitle">ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì˜ ëª¨ë“  ê´€ë¦¬ ê¸°ëŠ¥ì„<br>í•œ ê³³ì—ì„œ í¸ë¦¬í•˜ê²Œ ì´ìš©í•˜ì„¸ìš”</p>
        </div>

        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="tab-navigation">
            <button class="tab-button active" onclick="switchTab('members')" id="members-tab">
                ğŸ‘¥ ë©¤ë²„ ê´€ë¦¬
                <span class="badge" id="members-badge">3</span>
            </button>
            <button class="tab-button" onclick="switchTab('channels')" id="channels-tab">
                ğŸ’¬ ì±„ë„ ê´€ë¦¬
            </button>
            <button class="tab-button" onclick="switchTab('settings')" id="settings-tab">
                âš™ï¸ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì„¤ì •
            </button>
        </div>

        <!-- íƒ­ ì½˜í…ì¸ ë“¤ -->
        <div class="tab-content active" id="members-content">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <div>ë©¤ë²„ ê´€ë¦¬ í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>
        </div>

        <div class="tab-content" id="channels-content">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <div>ì±„ë„ ê´€ë¦¬ í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>
        </div>

        <div class="tab-content" id="settings-content">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <div>ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì„¤ì • í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            </div>
        </div>
    </div>

    <script>
        // ============================
        // ì „ì—­ ë³€ìˆ˜
        // ============================
        let currentTab = 'members';
        let loadedTabs = new Set(); // ì´ë¯¸ ë¡œë“œëœ íƒ­ë“¤ì„ ì¶”ì 
        
        // íƒ­ë³„ íŒŒì¼ ê²½ë¡œ ë§¤í•‘
        const tabFiles = {
            'members': 'admin-members.html',
            'channels': 'admin-channels.html', 
            'settings': 'admin-ws-settings.html'
        };

        // ============================
        // íƒ­ ì „í™˜ í•¨ìˆ˜
        // ============================
        async function switchTab(tabName) {
            // ì´ì „ íƒ­ ë¹„í™œì„±í™”
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // ìƒˆ íƒ­ í™œì„±í™”
            document.getElementById(`${tabName}-tab`).classList.add('active');
            document.getElementById(`${tabName}-content`).classList.add('active');
            
            currentTab = tabName;
            
            // íƒ­ì´ ì´ë¯¸ ë¡œë“œë˜ì§€ ì•Šì•˜ë‹¤ë©´ ë¡œë“œ
            if (!loadedTabs.has(tabName)) {
                await loadTabContent(tabName);
            }
        }

        // ============================
        // AJAXë¡œ íƒ­ ì½˜í…ì¸  ë¡œë“œ
        // ============================
        async function loadTabContent(tabName) {
            const contentContainer = document.getElementById(`${tabName}-content`);
            const fileName = tabFiles[tabName];
            
            if (!fileName) {
                showError(contentContainer, `ì•Œ ìˆ˜ ì—†ëŠ” íƒ­: ${tabName}`);
                return;
            }

            try {
                console.log(`ğŸ“¥ ë¡œë”© ì‹œì‘: ${fileName}`);
                
                const response = await fetch(fileName);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const htmlContent = await response.text();
                
                // HTML íŒŒì‹±í•˜ì—¬ body ë‚´ìš©ë§Œ ì¶”ì¶œ
                const parser = new DOMParser();
                const doc = parser.parseFromString(htmlContent, 'text/html');
                
                // body ë‚´ìš© ì¶”ì¶œ (ìŠ¤í¬ë¦½íŠ¸ í¬í•¨)
                const bodyContent = doc.body.innerHTML;
                
                // ì½˜í…ì¸  ì‚½ì…
                contentContainer.innerHTML = bodyContent;
                
                // ì‚½ì…ëœ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
                executeScripts(contentContainer);
                
                // ë¡œë“œ ì™„ë£Œ í‘œì‹œ
                loadedTabs.add(tabName);
                
                console.log(`âœ… ë¡œë”© ì™„ë£Œ: ${fileName}`);
                
                // íŠ¹ì • íƒ­ ë¡œë“œ í›„ ì¶”ê°€ ì‘ì—…
                handleTabLoaded(tabName);
                
            } catch (error) {
                console.error(`âŒ ë¡œë”© ì‹¤íŒ¨ (${fileName}):`, error);
                showError(contentContainer, `í˜ì´ì§€ ë¡œë”©ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.message}`, tabName);
            }
        }

        // ============================
        // ì‚½ì…ëœ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
        // ============================
        function executeScripts(container) {
            const scripts = container.querySelectorAll('script');
            scripts.forEach(script => {
                const newScript = document.createElement('script');
                
                if (script.src) {
                    newScript.src = script.src;
                } else {
                    newScript.textContent = script.textContent;
                }
                
                // ê¸°ì¡´ ìŠ¤í¬ë¦½íŠ¸ ì œê±°í•˜ê³  ìƒˆ ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€
                script.parentNode.replaceChild(newScript, script);
            });
        }

        // ============================
        // ì—ëŸ¬ í‘œì‹œ
        // ============================
        function showError(container, message, tabName = null) {
            container.innerHTML = `
                <div class="error-content">
                    <div class="error-icon">âŒ</div>
                    <h3>ë¡œë”© ì‹¤íŒ¨</h3>
                    <p>${message}</p>
                    ${tabName ? `<button class="retry-button" onclick="retryLoad('${tabName}')">ë‹¤ì‹œ ì‹œë„</button>` : ''}
                </div>
            `;
        }

        // ============================
        // ì¬ì‹œë„
        // ============================
        async function retryLoad(tabName) {
            const contentContainer = document.getElementById(`${tabName}-content`);
            
            // ë¡œë”© ìƒíƒœë¡œ ë³€ê²½
            contentContainer.innerHTML = `
                <div class="loading-content">
                    <div class="loading-spinner"></div>
                    <div>ë‹¤ì‹œ ë¡œë”© ì¤‘...</div>
                </div>
            `;
            
            // ë¡œë“œëœ íƒ­ ëª©ë¡ì—ì„œ ì œê±°í•˜ê³  ë‹¤ì‹œ ë¡œë“œ
            loadedTabs.delete(tabName);
            await loadTabContent(tabName);
        }

        // ============================
        // íƒ­ ë¡œë“œ ì™„ë£Œ í›„ ì²˜ë¦¬
        // ============================
        function handleTabLoaded(tabName) {
            switch (tabName) {
                case 'members':
                    // ë©¤ë²„ ê´€ë¦¬ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì‹œ
                    console.log('ğŸ‘¥ ë©¤ë²„ ê´€ë¦¬ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
                    break;
                    
                case 'channels':
                    // ì±„ë„ ê´€ë¦¬ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì‹œ
                    console.log('ğŸ’¬ ì±„ë„ ê´€ë¦¬ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
                    break;
                    
                case 'settings':
                    // ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì„¤ì • í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì‹œ
                    console.log('âš™ï¸ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì„¤ì • í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
                    break;
            }
            
            // ê³µí†µ ì²˜ë¦¬: CSS ìŠ¤íƒ€ì¼ ì¬ì ìš©, ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ì„¤ì • ë“±
            reinitializeLoadedContent(tabName);
        }

        // ============================
        // ë¡œë“œëœ ì½˜í…ì¸  ì¬ì´ˆê¸°í™”
        // ============================
        function reinitializeLoadedContent(tabName) {
            const container = document.getElementById(`${tabName}-content`);
            
            // ìƒëŒ€ ê²½ë¡œë¥¼ ì ˆëŒ€ ê²½ë¡œë¡œ ìˆ˜ì • (í•„ìš”í•œ ê²½ìš°)
            const images = container.querySelectorAll('img[src^="../../"]');
            images.forEach(img => {
                if (!img.src.startsWith('http')) {
                    img.src = img.getAttribute('src');
                }
            });
            
            // ë§í¬ë“¤ì˜ ìƒëŒ€ ê²½ë¡œ ìˆ˜ì • (í•„ìš”í•œ ê²½ìš°)
            const links = container.querySelectorAll('link[href^="../../"]');
            links.forEach(link => {
                if (!link.href.startsWith('http')) {
                    link.href = link.getAttribute('href');
                }
            });
        }

        // ============================
        // ê¸°íƒ€ í•¨ìˆ˜ë“¤
        // ============================
        
        // ì›Œí¬ìŠ¤í˜ì´ìŠ¤ë¡œ ëŒì•„ê°€ê¸°
        function goBackToWorkspace() {
            if (confirm('ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œë¥¼ ë‚˜ê°€ê³  ì›Œí¬ìŠ¤í˜ì´ìŠ¤ë¡œ ëŒì•„ê°€ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                // ê°œë°œ ëª¨ë“œ íŒŒë¼ë¯¸í„° ìœ ì§€
                const urlParams = new URLSearchParams(window.location.search);
                const devParam = urlParams.get('dev') === 'true' ? '?dev=true' : '';
                window.location.href = `../workspace/workspace-main.html${devParam}`;
            }
        }

        // URL íŒŒë¼ë¯¸í„°ë¡œ íŠ¹ì • íƒ­ ì—´ê¸°
        function openTabFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const tab = urlParams.get('tab');
            
            if (tab && tabFiles[tab]) {
                switchTab(tab);
            }
        }

        // ì•Œë¦¼ ë°°ì§€ ì—…ë°ì´íŠ¸
        function updateNotificationBadges() {
            // ì‹¤ì œë¡œëŠ” APIì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì•¼ í•¨
            const pendingMembers = 3; // ì˜ˆì‹œ ë°ì´í„°
            
            const membersBadge = document.getElementById('members-badge');
            if (pendingMembers > 0) {
                membersBadge.textContent = pendingMembers;
                membersBadge.style.display = 'block';
            } else {
                membersBadge.style.display = 'none';
            }
        }

        // ============================
        // ì´ˆê¸°í™”
        // ============================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™”');
            
            // URL íŒŒë¼ë¯¸í„° í™•ì¸
            openTabFromURL();
            
            // ì•Œë¦¼ ë°°ì§€ ì—…ë°ì´íŠ¸
            updateNotificationBadges();
            
            // ì²« ë²ˆì§¸ íƒ­ ë¡œë“œ
            loadTabContent(currentTab);
            
            // ê°œë°œ ëª¨ë“œ ì²´í¬
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('dev') === 'true') {
                console.log('ğŸ”§ ê°œë°œ ëª¨ë“œë¡œ ì‹¤í–‰ ì¤‘');
                
                // ê°œë°œ ëª¨ë“œ í‘œì‹œ
                document.body.style.borderTop = '4px solid #f59e0b';
                const devBadge = document.createElement('div');
                devBadge.innerHTML = 'ğŸ”§ ê°œë°œ ëª¨ë“œ';
                devBadge.style.cssText = `
                    position: fixed;
                    top: 4px;
                    right: 20px;
                    background: #f59e0b;
                    color: white;
                    padding: 4px 12px;
                    border-radius: 0 0 8px 8px;
                    font-size: 12px;
                    font-weight: 600;
                    z-index: 1000;
                `;
                document.body.appendChild(devBadge);
            }
            
            console.log('âœ… ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì™„ë£Œ');
        });

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
        document.addEventListener('keydown', function(e) {
            // ESC: ì›Œí¬ìŠ¤í˜ì´ìŠ¤ë¡œ ëŒì•„ê°€ê¸°
            if (e.key === 'Escape') {
                goBackToWorkspace();
            }
            
            // Ctrl + 1,2,3: íƒ­ ì „í™˜
            if (e.ctrlKey) {
                switch (e.key) {
                    case '1':
                        e.preventDefault();
                        switchTab('members');
                        break;
                    case '2':
                        e.preventDefault();
                        switchTab('channels');
                        break;
                    case '3':
                        e.preventDefault();
                        switchTab('settings');
                        break;
                }
            }
            
            // F5: í˜„ì¬ íƒ­ ìƒˆë¡œê³ ì¹¨
            if (e.key === 'F5') {
                e.preventDefault();
                loadedTabs.delete(currentTab);
                loadTabContent(currentTab);
            }
        });

        // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ (ë””ë²„ê¹…ìš©)
        window.adminDashboard = {
            switchTab: switchTab,
            loadTabContent: loadTabContent,
            currentTab: () => currentTab,
            loadedTabs: () => Array.from(loadedTabs),
            retryLoad: retryLoad,
            updateNotificationBadges: updateNotificationBadges
        };
        
        console.log('ğŸ”§ ê°œë°œì ë„êµ¬ì—ì„œ adminDashboard ê°ì²´ë¥¼ ì‚¬ìš©í•˜ì—¬ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
    </script>
</body>
</html>