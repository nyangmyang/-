<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì í˜ì´ì§€ - íšŒì› ê´€ë¦¬ (ìŠ¹ì¸ ëª¨ë‹¬ ê°œì„ )</title>
    
    <!-- CSS íŒŒì¼ë“¤ ì„í¬íŠ¸ -->
    <link rel="stylesheet" href="../../css/common.css">
    <link rel="stylesheet" href="../../css/admin-members.css">
    
    <style>
        /* ìŠ¹ì¸ ëª¨ë‹¬ ì „ìš© ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        .approval-modal {
            width: 90%;
            max-width: 520px;
        }
        
        .applicant-info {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
        }
        
        .applicant-info > div {
            margin: 0 0 8px 0;
            font-size: 14px;
            color: #374151;
        }
        
        .applicant-info > div:last-child {
            margin-bottom: 0;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }
        
        .form-label .required {
            color: #ef4444;
        }
        
        .radio-group {
            display: flex;
            gap: 16px;
            margin-top: 8px;
        }
        
        .radio-group label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            color: #374151;
            cursor: pointer;
        }
        
        .radio-group input[type="radio"] {
            margin: 0;
        }
        
        .date-inputs {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }
        
        .date-inputs select {
            padding: 8px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            min-width: 70px;
        }
        
        .date-inputs select:focus {
            outline: none;
            border-color: #0ea5e9;
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
        }
        
        .expires-section {
            background: #fef3c7;
            border: 2px solid #fbbf24;
            border-radius: 12px;
            padding: 16px;
            margin-top: 12px;
        }
        
        .role-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            background: white;
        }
        
        .role-select:focus {
            outline: none;
            border-color: #0ea5e9;
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
        }
    </style>
</head>
<body>
    <!-- ë°°ê²½ ì¥ì‹ -->
    <div class="bg-decoration"></div>
    <div class="bg-decoration"></div>
    <div class="bg-decoration"></div>

    <div class="admin-container">
        <!-- í—¤ë” -->
        <div class="header-section">
            <div class="admin-badge">ğŸ‘‘ ê´€ë¦¬ì</div>
            <div class="logo">ğŸŒŠ</div>
            <h1 class="welcome-text">ë©¤ë²„ ê´€ë¦¬</h1>
            <p class="subtitle">ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ë©¤ë²„ë“¤ì˜ ê°€ì… ìŠ¹ì¸ê³¼<br>ê¶Œí•œ ê´€ë¦¬ë¥¼ ìˆ˜í–‰í•˜ì„¸ìš”</p>
        </div>

        <!-- ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì •ë³´ -->
        <div class="workspace-info">
            <div class="workspace-icon">ğŸš€</div>
            <div class="workspace-details">
                <div class="workspace-name">ìŠ¤íƒ€íŠ¸ì—…íŒ€</div>
                <div class="workspace-meta">ì´ 24ëª…ì˜ ë©¤ë²„ â€¢ 3ëª… ìŠ¹ì¸ ëŒ€ê¸° ì¤‘</div>
            </div>
        </div>

        <!-- í†µê³„ ì„¹ì…˜ -->
        <div class="stats-section">
            <div class="section-title">
                ğŸ“Š ë©¤ë²„ í˜„í™©
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #0ea5e9, #2563eb);">ğŸ‘¥</div>
                    <div class="stat-number">24</div>
                    <div class="stat-label">ì „ì²´ ë©¤ë²„</div>
                    <div class="stat-change positive">+3 ì´ë²ˆ ì£¼</div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);">â³</div>
                    <div class="stat-number">3</div>
                    <div class="stat-label">ìŠ¹ì¸ ëŒ€ê¸°</div>
                    <div class="stat-change neutral">ìƒˆ ìš”ì²­</div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #10b981, #059669);">âœ…</div>
                    <div class="stat-number">21</div>
                    <div class="stat-label">í™œì„± ë©¤ë²„</div>
                    <div class="stat-change positive">87.5%</div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #ef4444, #dc2626);">ğŸš«</div>
                    <div class="stat-number">0</div>
                    <div class="stat-label">ì •ì§€ëœ ë©¤ë²„</div>
                    <div class="stat-change neutral">ë³€í™” ì—†ìŒ</div>
                </div>
            </div>
        </div>

        <!-- íƒ­ ì„¹ì…˜ -->
        <div class="tab-section">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="switchTab('pending')" id="pending-tab">
                    ìŠ¹ì¸ ëŒ€ê¸°
                    <span class="tab-badge">3</span>
                </button>
                <button class="tab-button" onclick="switchTab('active')" id="active-tab">
                    í™œì„± ë©¤ë²„
                </button>
                <button class="tab-button" onclick="switchTab('suspended')" id="suspended-tab">
                    ì •ì§€ëœ ë©¤ë²„
                </button>
            </div>

            <!-- ìŠ¹ì¸ ëŒ€ê¸° íƒ­ -->
            <div class="tab-content active" id="pending-content">
                <div class="content-header">
                    <input type="text" class="search-input" placeholder="ì´ë¦„, ì´ë©”ì¼ë¡œ ê²€ìƒ‰..." id="pending-search">
                    <select class="filter-select" id="pending-filter">
                        <option value="all">ëª¨ë“  ìš”ì²­</option>
                        <option value="recent">ìµœê·¼ ìš”ì²­</option>
                        <option value="old">ì˜¤ë˜ëœ ìš”ì²­</option>
                    </select>
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="inviteMembers()">
                            â• ë©¤ë²„ ì´ˆëŒ€
                        </button>
                    </div>
                </div>

                <div class="members-grid" id="pending-list">
                    <!-- í…ŒìŠ¤íŠ¸ìš© ìŠ¹ì¸ ëŒ€ê¸° ë©¤ë²„ -->
                    <div class="member-card" data-member-id="1">
                        <div class="member-header">
                            <div class="member-avatar">ê¹€</div>
                            <div class="member-info">
                                <div class="member-name">ê¹€ì‹ ì…</div>
                                <div class="member-email">newbie@example.com</div>
                                <div class="member-status">
                                    <span class="status-badge status-pending">â³ ìŠ¹ì¸ ëŒ€ê¸°</span>
                                </div>
                            </div>
                        </div>
                        <div class="member-meta">
                            <div class="meta-row">
                                <span class="meta-label">ì‹ ì²­ ì§ê¸‰</span>
                                <span class="meta-value">ğŸ·ï¸ ì‚¬ì›</span>
                            </div>
                            <div class="meta-row">
                                <span class="meta-label">ìš”ì²­ì¼</span>
                                <span class="meta-value">ğŸ“… 2024-01-15</span>
                            </div>
                            <div class="meta-row">
                                <span class="meta-label">ì´ˆëŒ€ ì½”ë“œ</span>
                                <span class="meta-value">ğŸ”— ABC123</span>
                            </div>
                        </div>
                        <div class="member-actions">
                            <button class="action-btn action-approve" onclick="approveMember(1, 'ê¹€ì‹ ì…', 'newbie@example.com', 'ì‚¬ì›', 'ABC123')">
                                âœ… ìŠ¹ì¸
                            </button>
                            <button class="action-btn action-reject" onclick="rejectMember(1, 'ê¹€ì‹ ì…')">
                                âŒ ê±°ë¶€
                            </button>
                        </div>
                    </div>

                    <div class="member-card" data-member-id="2">
                        <div class="member-header">
                            <div class="member-avatar">ì´</div>
                            <div class="member-info">
                                <div class="member-name">ì´íŒŒê²¬</div>
                                <div class="member-email">contractor@example.com</div>
                                <div class="member-status">
                                    <span class="status-badge status-pending">â³ ìŠ¹ì¸ ëŒ€ê¸°</span>
                                </div>
                            </div>
                        </div>
                        <div class="member-meta">
                            <div class="meta-row">
                                <span class="meta-label">ì‹ ì²­ ì§ê¸‰</span>
                                <span class="meta-value">ğŸ·ï¸ ëŒ€ë¦¬</span>
                            </div>
                            <div class="meta-row">
                                <span class="meta-label">ìš”ì²­ì¼</span>
                                <span class="meta-value">ğŸ“… 2024-01-16</span>
                            </div>
                            <div class="meta-row">
                                <span class="meta-label">ì´ˆëŒ€ ì½”ë“œ</span>
                                <span class="meta-value">ğŸ”— DEF456</span>
                            </div>
                        </div>
                        <div class="member-actions">
                            <button class="action-btn action-approve" onclick="approveMember(2, 'ì´íŒŒê²¬', 'contractor@example.com', 'ëŒ€ë¦¬', 'DEF456')">
                                âœ… ìŠ¹ì¸
                            </button>
                            <button class="action-btn action-reject" onclick="rejectMember(2, 'ì´íŒŒê²¬')">
                                âŒ ê±°ë¶€
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- í™œì„± ë©¤ë²„ íƒ­ -->
            <div class="tab-content" id="active-content">
                <div class="content-header">
                    <input type="text" class="search-input" placeholder="ì´ë¦„, ì´ë©”ì¼ë¡œ ê²€ìƒ‰..." id="active-search">
                    <select class="filter-select" id="active-filter">
                        <option value="all">ëª¨ë“  ë©¤ë²„</option>
                        <option value="admin">ê´€ë¦¬ì</option>
                        <option value="member">ì¼ë°˜ ë©¤ë²„</option>
                        <option value="contractor">íŒŒê²¬ì§</option>
                    </select>
                    <div class="action-buttons">
                        <button class="btn btn-secondary" onclick="exportMembers()">
                            ğŸ“¤ ë‚´ë³´ë‚´ê¸°
                        </button>
                        <button class="btn btn-primary" onclick="inviteMembers()">
                            â• ë©¤ë²„ ì´ˆëŒ€
                        </button>
                    </div>
                </div>

                <div class="members-grid" id="active-list">
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ‘¥</div>
                        <div class="empty-title">í™œì„± ë©¤ë²„ê°€ í‘œì‹œë©ë‹ˆë‹¤</div>
                        <div class="empty-description">ìŠ¹ì¸ëœ ë©¤ë²„ë“¤ì´ ì—¬ê¸°ì— ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</div>
                    </div>
                </div>
            </div>

            <!-- ì •ì§€ëœ ë©¤ë²„ íƒ­ -->
            <div class="tab-content" id="suspended-content">
                <div class="empty-state">
                    <div class="empty-icon">ğŸš«</div>
                    <div class="empty-title">ì •ì§€ëœ ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤</div>
                    <div class="empty-description">í˜„ì¬ ì •ì§€ëœ ë©¤ë²„ê°€ ì—†ìŠµë‹ˆë‹¤.<br>í•„ìš”ì‹œ ë©¤ë²„ ê´€ë¦¬ì—ì„œ ì •ì§€ ì¡°ì¹˜ë¥¼ ì·¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ìŠ¹ì¸ ëª¨ë‹¬ (ê°œì„ ëœ ë²„ì „) -->
    <div class="modal-overlay" id="approval-modal">
        <div class="modal approval-modal">
            <div class="modal-header">
                <div class="modal-icon">âœ…</div>
                <div class="modal-title">ë©¤ë²„ ìŠ¹ì¸</div>
                <div class="modal-description">ê°€ì… ìŠ¹ì¸ ë° ì„¤ì •ì„ ì§„í–‰í•©ë‹ˆë‹¤</div>
            </div>
            
            <!-- ì‹ ì²­ì ì •ë³´ -->
            <div class="applicant-info" id="applicant-info">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <span><strong>â€¢ ì´ë¦„:</strong> <span id="applicant-name">ê¹€ì‹ ì…</span></span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <span><strong>â€¢ ì´ë©”ì¼:</strong> <span id="applicant-email">newbie@example.com</span></span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <span><strong>â€¢ ì‹ ì²­ ì§ê¸‰:</strong> <span id="applicant-role">ì‚¬ì›</span></span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <span><strong>â€¢ ì´ˆëŒ€ ì½”ë“œ:</strong> <span id="applicant-code">ABC123</span></span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <span><strong>â€¢ íŒŒê²¬ì§:</strong></span>
                    <div class="radio-group" style="margin: 0;">
                        <label style="margin-right: 8px;">
                            <input type="radio" name="is_contractor" value="false" checked>
                            No
                        </label>
                        <label>
                            <input type="radio" name="is_contractor" value="true">
                            Yes
                        </label>
                    </div>
                </div>
                <!-- ë§Œë£Œì¼ ì„¤ì • (íŒŒê²¬ì§ Yes ì„ íƒ ì‹œë§Œ í‘œì‹œ) -->
                <div id="expires-section" style="display: none; margin-top: 8px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span><strong>â€¢ ë§Œë£Œì¼:</strong></span>
                        <div class="date-inputs" style="margin: 0;">
                            <select id="expire-year" required style="min-width: 65px;">
                                <option value="">ë…„</option>
                                <option value="2024">2024</option>
                                <option value="2025">2025</option>
                                <option value="2026">2026</option>
                                <option value="2027">2027</option>
                            </select>
                            <span>ë…„</span>
                            
                            <select id="expire-month" required style="min-width: 50px;">
                                <option value="">ì›”</option>
                                <option value="01">01</option>
                                <option value="02">02</option>
                                <option value="03">03</option>
                                <option value="04">04</option>
                                <option value="05">05</option>
                                <option value="06">06</option>
                                <option value="07">07</option>
                                <option value="08">08</option>
                                <option value="09">09</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                            </select>
                            <span>ì›”</span>
                            
                            <select id="expire-day" required style="min-width: 50px;">
                                <option value="">ì¼</option>
                                <option value="01">01</option>
                                <option value="02">02</option>
                                <option value="03">03</option>
                                <option value="04">04</option>
                                <option value="05">05</option>
                                <option value="06">06</option>
                                <option value="07">07</option>
                                <option value="08">08</option>
                                <option value="09">09</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                                <option value="13">13</option>
                                <option value="14">14</option>
                                <option value="15">15</option>
                                <option value="16">16</option>
                                <option value="17">17</option>
                                <option value="18">18</option>
                                <option value="19">19</option>
                                <option value="20">20</option>
                                <option value="21">21</option>
                                <option value="22">22</option>
                                <option value="23">23</option>
                                <option value="24">24</option>
                                <option value="25">25</option>
                                <option value="26">26</option>
                                <option value="27">27</option>
                                <option value="28">28</option>
                                <option value="29">29</option>
                                <option value="30">30</option>
                                <option value="31">31</option>
                            </select>
                            <span>ì¼</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ìµœì¢… ì§ê¸‰ ì„¤ì • -->
            <div class="form-group">
                <label class="form-label">
                    ìµœì¢… ì§ê¸‰ <span class="required">*</span>
                </label>
                <select class="role-select" id="final-role">
                    <option value="">ì§ê¸‰ì„ ì„ íƒí•˜ì„¸ìš”</option>
                    <option value="ì¸í„´">ì¸í„´</option>
                    <option value="ì‚¬ì›">ì‚¬ì›</option>
                    <option value="ëŒ€ë¦¬">ëŒ€ë¦¬</option>
                    <option value="ê³¼ì¥">ê³¼ì¥</option>
                    <option value="ì°¨ì¥">ì°¨ì¥</option>
                    <option value="íŒ€ì¥">íŒ€ì¥</option>
                    <option value="ë¶€ì¥">ë¶€ì¥</option>
                    <option value="ì´ì‚¬">ì´ì‚¬</option>
                </select>
            </div>

            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeApprovalModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" id="confirm-approval-btn" onclick="confirmApproval()">
                    <div class="loading-spinner" id="approval-spinner"></div>
                    <span id="approval-text">ìŠ¹ì¸í•˜ê¸°</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ê¸°ì¡´ í™•ì¸ ëª¨ë‹¬ -->
    <div class="modal-overlay" id="confirm-modal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon" id="modal-icon">âš ï¸</div>
                <div class="modal-title" id="modal-title">ì‘ì—… í™•ì¸</div>
                <div class="modal-description" id="modal-description">ì´ ì‘ì—…ì„ ìˆ˜í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" id="confirm-btn" onclick="confirmAction()">
                    <div class="loading-spinner" id="modal-spinner"></div>
                    <span id="confirm-text">í™•ì¸</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // ============================
        // ì „ì—­ ë³€ìˆ˜
        // ============================
        const API_BASE_URL = 'http://localhost:8000';
        let currentAction = null;
        let targetMember = null;
        let approvalMember = null;

        // ============================
        // ì´ˆê¸°í™”
        // ============================
        document.addEventListener('DOMContentLoaded', function() {
            setupContractorToggle();
            setupModalClose();
        });

        // ============================
        // íŒŒê²¬ì§ í† ê¸€ ì„¤ì •
        // ============================
        function setupContractorToggle() {
            const contractorRadios = document.querySelectorAll('input[name="is_contractor"]');
            const expiresSection = document.getElementById('expires-section');
            
            contractorRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'true') {
                        expiresSection.style.display = 'block';
                        // í•„ìˆ˜ ì…ë ¥ìœ¼ë¡œ ì„¤ì •
                        document.getElementById('expire-year').required = true;
                        document.getElementById('expire-month').required = true;
                        document.getElementById('expire-day').required = true;
                    } else {
                        expiresSection.style.display = 'none';
                        // í•„ìˆ˜ í•´ì œ
                        document.getElementById('expire-year').required = false;
                        document.getElementById('expire-month').required = false;
                        document.getElementById('expire-day').required = false;
                        // ê°’ ì´ˆê¸°í™”
                        document.getElementById('expire-year').value = '';
                        document.getElementById('expire-month').value = '';
                        document.getElementById('expire-day').value = '';
                    }
                });
            });
        }

        // ============================
        // ìŠ¹ì¸ ëª¨ë‹¬ ê´€ë¦¬
        // ============================
        function approveMember(memberId, memberName, memberEmail, memberRole, inviteCode) {
            approvalMember = { 
                id: memberId, 
                name: memberName, 
                email: memberEmail, 
                role: memberRole,
                inviteCode: inviteCode
            };
            
            // ì‹ ì²­ì ì •ë³´ ì„¤ì •
            document.getElementById('applicant-name').textContent = memberName;
            document.getElementById('applicant-email').textContent = memberEmail;
            document.getElementById('applicant-role').textContent = memberRole;
            document.getElementById('applicant-code').textContent = inviteCode;
            
            // ìµœì¢… ì§ê¸‰ì„ ì‹ ì²­ ì§ê¸‰ê³¼ ê°™ê²Œ ê¸°ë³¸ ì„¤ì •
            document.getElementById('final-role').value = memberRole;
            
            // íŒŒê²¬ì§ ì„¤ì • ì´ˆê¸°í™”
            document.querySelector('input[name="is_contractor"][value="false"]').checked = true;
            document.getElementById('expires-section').style.display = 'none';
            
            // ë§Œë£Œì¼ ì´ˆê¸°í™”
            document.getElementById('expire-year').value = '';
            document.getElementById('expire-month').value = '';
            document.getElementById('expire-day').value = '';
            
            // ëª¨ë‹¬ í‘œì‹œ
            document.getElementById('approval-modal').style.display = 'flex';
        }

        function closeApprovalModal() {
            document.getElementById('approval-modal').style.display = 'none';
            approvalMember = null;
        }

        async function confirmApproval() {
            if (!approvalMember) return;

            const finalRole = document.getElementById('final-role').value.trim();
            const isContractor = document.querySelector('input[name="is_contractor"]:checked').value === 'true';
            
            if (!finalRole) {
                alert('ìµœì¢… ì§ê¸‰ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            let expiresAt = null;
            if (isContractor) {
                const year = document.getElementById('expire-year').value;
                const month = document.getElementById('expire-month').value;
                const day = document.getElementById('expire-day').value;
                
                if (!year || !month || !day) {
                    alert('íŒŒê²¬ ë§Œë£Œì¼ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
                
                expiresAt = `${year}-${month}-${day}T23:59:59`;
            }

            const confirmBtn = document.getElementById('confirm-approval-btn');
            const confirmText = document.getElementById('approval-text');
            const spinner = document.getElementById('approval-spinner');

            // ë¡œë”© ìƒíƒœ
            confirmBtn.disabled = true;
            confirmText.textContent = 'ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘...';
            spinner.style.display = 'inline-block';

            try {
                // API í˜¸ì¶œ ë°ì´í„° ì¤€ë¹„
                const approvalData = {
                    status: "approved",
                    role_name: finalRole,
                    is_contractor: isContractor,
                    expires_at: expiresAt
                };

                console.log('ìŠ¹ì¸ ë°ì´í„°:', approvalData);

                // ì‹¤ì œ API í˜¸ì¶œ (ì„ì‹œë¡œ ì„±ê³µ ì²˜ë¦¬)
                const result = await approveMemberAPI(approvalMember.id, approvalData);
                
                if (result.success) {
                    const contractorText = isContractor ? ` (íŒŒê²¬ì§, ~${year}.${month}.${day})` : ' (ì •ê·œì§)';
                    alert(`âœ… ${approvalMember.name}ë‹˜ì´ ${finalRole}${contractorText}ìœ¼ë¡œ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤!`);
                    
                    // í•´ë‹¹ ë©¤ë²„ ì¹´ë“œ ì œê±°
                    const memberCard = document.querySelector(`[data-member-id="${approvalMember.id}"]`);
                    if (memberCard) {
                        memberCard.style.animation = 'fadeOut 0.3s ease-out forwards';
                        setTimeout(() => {
                            memberCard.remove();
                        }, 300);
                    }
                    
                    // í†µê³„ ì—…ë°ì´íŠ¸
                    updateStats('approve');
                    
                    closeApprovalModal();
                } else {
                    alert(`âŒ ìŠ¹ì¸ ì‹¤íŒ¨: ${result.error}`);
                }
            } catch (error) {
                console.error('ìŠ¹ì¸ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                alert('âŒ ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                // ë¡œë”© ìƒíƒœ ì›ë³µ
                confirmBtn.disabled = false;
                confirmText.textContent = 'ìŠ¹ì¸í•˜ê¸°';
                spinner.style.display = 'none';
            }
        }

        // ============================
        // API í˜¸ì¶œ
        // ============================
        async function approveMemberAPI(memberId, approvalData) {
            try {
                // ì‹¤ì œ API í˜¸ì¶œ ì½”ë“œ
                /*
                const token = localStorage.getItem('access_token');
                const response = await fetch(`${API_BASE_URL}/admin/requests/${memberId}/approve`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(approvalData)
                });

                if (response.ok) {
                    return { success: true };
                } else {
                    const data = await response.json();
                    return { success: false, error: data.detail || 'ìŠ¹ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.' };
                }
                */
                
                // ì„ì‹œ ì„±ê³µ ì²˜ë¦¬ (ê°œë°œìš©)
                await new Promise(resolve => setTimeout(resolve, 1000)); // 1ì´ˆ ëŒ€ê¸°
                return { success: true };
                
            } catch (error) {
                return { success: false, error: 'ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.' };
            }
        }

        // ============================
        // ê¸°ì¡´ ê¸°ëŠ¥ë“¤
        // ============================
        function switchTab(tabName) {
            // íƒ­ ë²„íŠ¼ í™œì„±í™”
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`${tabName}-tab`).classList.add('active');

            // íƒ­ ì½˜í…ì¸  ì „í™˜
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`${tabName}-content`).classList.add('active');
        }

        function rejectMember(memberId, memberName) {
            currentAction = 'reject';
            targetMember = { id: memberId, name: memberName };
            
            showModal(
                'âŒ',
                'ê°€ì… ê±°ë¶€',
                `${memberName}ë‹˜ì˜ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ê°€ì… ìš”ì²­ì„ ê±°ë¶€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`,
                'ê±°ë¶€í•˜ê¸°'
            );
        }

        function showModal(icon, title, description, confirmText) {
            document.getElementById('modal-icon').textContent = icon;
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-description').textContent = description;
            document.getElementById('confirm-text').textContent = confirmText;
            document.getElementById('confirm-modal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('confirm-modal').style.display = 'none';
            currentAction = null;
            targetMember = null;
        }

        async function confirmAction() {
            if (!currentAction || !targetMember) return;

            const confirmBtn = document.getElementById('confirm-btn');
            const confirmText = document.getElementById('confirm-text');
            const spinner = document.getElementById('modal-spinner');

            // ë¡œë”© ìƒíƒœ
            confirmBtn.disabled = true;
            confirmText.textContent = 'ì²˜ë¦¬ ì¤‘...';
            spinner.style.display = 'inline-block';

            try {
                let result;
                
                switch (currentAction) {
                    case 'reject':
                        result = await rejectMemberAPI(targetMember.id);
                        break;
                    default:
                        result = { success: false, error: 'ì•Œ ìˆ˜ ì—†ëŠ” ì‘ì—…ì…ë‹ˆë‹¤.' };
                }

                if (result.success) {
                    alert(`âŒ ${targetMember.name}ë‹˜ì˜ ê°€ì… ìš”ì²­ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                    
                    // í•´ë‹¹ ë©¤ë²„ ì¹´ë“œ ì œê±°
                    const memberCard = document.querySelector(`[data-member-id="${targetMember.id}"]`);
                    if (memberCard) {
                        memberCard.style.animation = 'fadeOut 0.3s ease-out forwards';
                        setTimeout(() => {
                            memberCard.remove();
                        }, 300);
                    }
                    
                    // í†µê³„ ì—…ë°ì´íŠ¸
                    updateStats('reject');
                    
                    closeModal();
                } else {
                    alert(`âŒ ì˜¤ë¥˜: ${result.error}`);
                }
            } catch (error) {
                alert('âŒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                // ë¡œë”© ìƒíƒœ ì›ë³µ
                confirmBtn.disabled = false;
                confirmText.textContent = 'ê±°ë¶€í•˜ê¸°';
                spinner.style.display = 'none';
            }
        }

        async function rejectMemberAPI(memberId) {
            try {
                // ì„ì‹œ ì„±ê³µ ì²˜ë¦¬ (ê°œë°œìš©)
                await new Promise(resolve => setTimeout(resolve, 800));
                return { success: true };
            } catch (error) {
                return { success: false, error: 'ê±°ë¶€ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.' };
            }
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats(action) {
            if (action === 'approve' || action === 'reject') {
                // ìŠ¹ì¸ ëŒ€ê¸° -1
                const pendingBadge = document.querySelector('#pending-tab .tab-badge');
                const currentPending = parseInt(pendingBadge.textContent) - 1;
                if (currentPending > 0) {
                    pendingBadge.textContent = currentPending;
                } else {
                    pendingBadge.remove();
                }
            }
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ë° ESC í‚¤ ì²˜ë¦¬
        function setupModalClose() {
            // ìŠ¹ì¸ ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
            document.getElementById('approval-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeApprovalModal();
                }
            });

            // í™•ì¸ ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
            document.getElementById('confirm-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });

            // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeApprovalModal();
                    closeModal();
                }
            });
        }

        // ê¸°íƒ€ ê¸°ëŠ¥ë“¤
        function inviteMembers() {
            const inviteCode = Math.random().toString(36).substr(2, 6).toUpperCase();
            
            const message = `ğŸ‰ ìƒˆ ë©¤ë²„ ì´ˆëŒ€ ì½”ë“œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nğŸ”— ì´ˆëŒ€ ì½”ë“œ: ${inviteCode}\n\nì´ ì½”ë“œë¥¼ ìƒˆ ë©¤ë²„ì—ê²Œ ê³µìœ í•˜ì—¬ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ì— ì´ˆëŒ€í•˜ì„¸ìš”.`;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(inviteCode).then(() => {
                    alert(message + '\n\nğŸ“‹ ì´ˆëŒ€ ì½”ë“œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
                });
            } else {
                alert(message);
            }
        }

        function exportMembers() {
            alert('ğŸ“¤ ë©¤ë²„ ëª©ë¡ ë‚´ë³´ë‚´ê¸° ê¸°ëŠ¥ì€ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.');
        }

        // ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeOut {
                from {
                    opacity: 1;
                    transform: scale(1);
                }
                to {
                    opacity: 0;
                    transform: scale(0.9);
                }
            }
            
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);

        // ê°œë°œì ë„êµ¬ìš© ë””ë²„ê¹…
        window.debugAdmin = {
            switchToTab: (tab) => switchTab(tab),
            simulateApproval: (memberId) => {
                const memberCard = document.querySelector(`[data-member-id="${memberId}"]`);
                if (memberCard) {
                    memberCard.remove();
                    updateStats('approve');
                }
                console.log(`ë©¤ë²„ ${memberId} ìŠ¹ì¸ì´ ì‹œë®¬ë ˆì´ì…˜ë˜ì—ˆìŠµë‹ˆë‹¤.`);
            },
            openApprovalModal: () => {
                approveMember(1, 'ê¹€ì‹ ì…', 'newbie@example.com', 'ì‚¬ì›', 'ABC123');
            },
            testContractorToggle: () => {
                document.querySelector('input[name="is_contractor"][value="true"]').click();
                console.log('íŒŒê²¬ì§ í† ê¸€ í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
            }
        };
        
        console.log('ğŸ”§ ê°œë°œì ë„êµ¬ì—ì„œ debugAdmin ê°ì²´ë¥¼ ì‚¬ìš©í•˜ì—¬ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        console.log('ì˜ˆ: debugAdmin.openApprovalModal(), debugAdmin.testContractorToggle()');
    </script>
</body>
</html>